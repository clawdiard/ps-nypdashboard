<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYP Dashboard ‚Äî NewYork-Presbyterian Performance Overview</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--card:#12121a;--card-border:#1e1e2e;--accent:#4a9eff;--accent2:#7c5cfc;--accent3:#00c9a7;--text:#e4e4e7;--text-muted:#71717a;--text-dim:#52525b;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
a{color:var(--accent);text-decoration:none}

/* Header */
.header{padding:2rem 2rem 1rem;border-bottom:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem}
.header h1{font-size:1.8rem;font-weight:700;letter-spacing:-0.02em}
.header h1 span{color:var(--accent)}
.header .subtitle{color:var(--text-muted);font-size:0.85rem;margin-top:0.25rem}
.header .badge{background:var(--accent);color:#000;font-size:0.7rem;font-weight:700;padding:0.25rem 0.6rem;border-radius:999px;text-transform:uppercase;letter-spacing:0.05em}
.last-updated{color:var(--text-dim);font-size:0.75rem}

/* Grid */
.dashboard{padding:1.5rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.25rem;max-width:1400px;margin:0 auto}
.card{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:1.5rem;transition:border-color 0.2s}
.card:hover{border-color:var(--accent)}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
.card-title{font-size:0.8rem;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-muted);font-weight:600}
.card-icon{font-size:1.2rem}

/* KPI Cards */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem}
.kpi{text-align:center}
.kpi .value{font-size:2rem;font-weight:700;letter-spacing:-0.02em;line-height:1.1}
.kpi .label{font-size:0.75rem;color:var(--text-muted);margin-top:0.3rem}
.kpi .change{font-size:0.7rem;margin-top:0.2rem;font-weight:600}
.kpi .change.up{color:var(--success)}
.kpi .change.down{color:var(--danger)}
.kpi .change.neutral{color:var(--warning)}

/* Stat rows */
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:0.6rem 0;border-bottom:1px solid var(--card-border)}
.stat-row:last-child{border-bottom:none}
.stat-row .label{color:var(--text-muted);font-size:0.85rem}
.stat-row .value{font-weight:600;font-size:0.9rem}

/* Bar charts */
.bar-chart{display:flex;flex-direction:column;gap:0.6rem;margin-top:0.5rem}
.bar-item{display:flex;align-items:center;gap:0.75rem}
.bar-label{width:120px;font-size:0.78rem;color:var(--text-muted);flex-shrink:0;text-align:right}
.bar-track{flex:1;height:22px;background:#1a1a2e;border-radius:6px;overflow:hidden;position:relative}
.bar-fill{height:100%;border-radius:6px;transition:width 1s ease;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;font-size:0.7rem;font-weight:600;color:#fff;min-width:fit-content}
.bar-fill.blue{background:linear-gradient(90deg,var(--accent),#6db3ff)}
.bar-fill.purple{background:linear-gradient(90deg,var(--accent2),#a78bfa)}
.bar-fill.green{background:linear-gradient(90deg,var(--accent3),#34d399)}
.bar-fill.gold{background:linear-gradient(90deg,#d97706,#fbbf24)}

/* Quality stars */
.stars{display:flex;gap:0.15rem;font-size:1rem}
.star.filled{color:#fbbf24}
.star.empty{color:var(--text-dim)}

/* Campus list */
.campus-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;margin-top:0.5rem}
.campus-item{background:#1a1a2e;border-radius:8px;padding:0.75rem;text-align:center}
.campus-item .name{font-size:0.75rem;font-weight:600;margin-bottom:0.3rem;color:var(--accent)}
.campus-item .beds{font-size:1.3rem;font-weight:700}
.campus-item .type{font-size:0.65rem;color:var(--text-dim);margin-top:0.15rem}

/* Rankings table */
.ranking-table{width:100%;margin-top:0.5rem}
.ranking-table th{text-align:left;font-size:0.7rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);padding:0.4rem 0;border-bottom:1px solid var(--card-border)}
.ranking-table td{padding:0.5rem 0;font-size:0.82rem;border-bottom:1px solid #1a1a2e}
.ranking-table .rank{color:var(--accent);font-weight:700}

/* Tag cloud */
.tag-cloud{display:flex;flex-wrap:wrap;gap:0.5rem;margin-top:0.5rem}
.tag{background:#1a1a2e;border:1px solid var(--card-border);border-radius:6px;padding:0.35rem 0.7rem;font-size:0.75rem;color:var(--text-muted)}
.tag.highlight{border-color:var(--accent);color:var(--accent)}

/* Footer */
.footer{text-align:center;padding:2rem;color:var(--text-dim);font-size:0.7rem;border-top:1px solid var(--card-border);margin-top:1rem}

/* Responsive iPad */
@media(min-width:768px) and (max-width:1024px){
  .dashboard{grid-template-columns:repeat(2,1fr);padding:1rem}
  .card{padding:1.25rem}
}
@media(max-width:767px){
  .dashboard{grid-template-columns:1fr;padding:1rem}
  .header{padding:1.5rem 1rem 1rem}
  .header h1{font-size:1.4rem}
  .campus-grid{grid-template-columns:1fr}
}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.card{animation:fadeIn 0.5s ease both}
.card:nth-child(2){animation-delay:0.05s}
.card:nth-child(3){animation-delay:0.1s}
.card:nth-child(4){animation-delay:0.15s}
.card:nth-child(5){animation-delay:0.2s}
.card:nth-child(6){animation-delay:0.25s}
.card:nth-child(7){animation-delay:0.3s}
.card:nth-child(8){animation-delay:0.35s}
.card:nth-child(9){animation-delay:0.4s}
.card:nth-child(10){animation-delay:0.45s}

/* Sparkline */
.sparkline{display:flex;align-items:flex-end;gap:2px;height:40px;margin-top:0.5rem}
.sparkline .bar{flex:1;background:var(--accent);border-radius:2px 2px 0 0;opacity:0.7;transition:opacity 0.2s}
.sparkline .bar:hover{opacity:1}

/* Donut chart CSS */
.donut-container{display:flex;align-items:center;gap:1.5rem;margin-top:0.5rem}
.donut{width:100px;height:100px;border-radius:50%;position:relative;flex-shrink:0}
.donut-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.donut-center .value{font-size:1.2rem;font-weight:700}
.donut-center .label{font-size:0.6rem;color:var(--text-muted)}
.donut-legend{display:flex;flex-direction:column;gap:0.4rem}
.legend-item{display:flex;align-items:center;gap:0.5rem;font-size:0.75rem;color:var(--text-muted)}
.legend-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}

/* Map */
#campus-map{background:#0d1117}
.leaflet-popup-content-wrapper{background:var(--card);color:var(--text);border:1px solid var(--card-border);border-radius:10px;box-shadow:0 8px 32px rgba(0,0,0,0.5)}
.leaflet-popup-tip{background:var(--card)}
.leaflet-popup-content{margin:12px 16px;font-family:inherit}
.leaflet-popup-content .popup-name{font-size:1rem;font-weight:700;color:var(--accent);margin-bottom:4px}
.leaflet-popup-content .popup-type{font-size:0.75rem;color:var(--text-muted);margin-bottom:8px}
.leaflet-popup-content .popup-stat{display:flex;justify-content:space-between;padding:3px 0;font-size:0.8rem}
.leaflet-popup-content .popup-stat .label{color:var(--text-muted)}
.leaflet-popup-content .popup-stat .val{font-weight:600}
.campus-marker{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background:var(--accent);border:3px solid #fff;box-shadow:0 2px 12px rgba(74,158,255,0.5);font-size:14px;font-weight:700;color:#000;transition:transform 0.2s}
.campus-marker:hover{transform:scale(1.2)}
.campus-marker.academic{background:var(--accent2);box-shadow:0 2px 12px rgba(124,92,252,0.5)}
.campus-marker.behavioral{background:var(--accent3);box-shadow:0 2px 12px rgba(0,201,167,0.5)}
.leaflet-control-zoom a{background:var(--card)!important;color:var(--text)!important;border-color:var(--card-border)!important}
.leaflet-control-attribution{background:rgba(10,10,15,0.8)!important;color:var(--text-dim)!important;font-size:0.6rem!important}
.leaflet-control-attribution a{color:var(--text-muted)!important}
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>üè• <span>NYP</span> Dashboard</h1>
    <div class="subtitle">NewYork-Presbyterian Hospital System ‚Äî Performance Overview</div>
  </div>
  <div style="text-align:right">
    <span class="badge">FY 2025</span>
    <div class="last-updated">Data as of Feb 2026 ¬∑ Public filings & US News</div>
  </div>
</div>

<div class="dashboard">

  <!-- System Overview KPIs -->
  <div class="card" style="grid-column:1/-1">
    <div class="card-header">
      <span class="card-title">System Overview</span>
      <span class="card-icon">üìä</span>
    </div>
    <div class="kpi-grid">
      <div class="kpi">
        <div class="value" style="color:var(--accent)">2,600+</div>
        <div class="label">Licensed Beds</div>
        <div class="change up">‚ñ≤ Top 5 US systems</div>
      </div>
      <div class="kpi">
        <div class="value" style="color:var(--accent3)">$12.8B</div>
        <div class="label">Annual Revenue</div>
        <div class="change up">‚ñ≤ 6.2% YoY</div>
      </div>
      <div class="kpi">
        <div class="value" style="color:var(--accent2)">48,000+</div>
        <div class="label">Employees</div>
        <div class="change up">‚ñ≤ 2.1% growth</div>
      </div>
      <div class="kpi">
        <div class="value" style="color:#fbbf24">2.1M+</div>
        <div class="label">Patient Visits/Year</div>
        <div class="change neutral">‚Äî Stable</div>
      </div>
      <div class="kpi">
        <div class="value" style="color:var(--success)">#1</div>
        <div class="label">in New York (US News)</div>
        <div class="change up">22 consecutive years</div>
      </div>
      <div class="kpi">
        <div class="value" style="color:var(--accent)">#4</div>
        <div class="label">National Honor Roll</div>
        <div class="change up">‚ñ≤ from #6</div>
      </div>
    </div>
  </div>

  <!-- Campus Breakdown -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Campus Network</span>
      <span class="card-icon">üèóÔ∏è</span>
    </div>
    <div class="campus-grid">
      <div class="campus-item">
        <div class="name">Weill Cornell</div>
        <div class="beds">862</div>
        <div class="type">Academic Medical Center</div>
      </div>
      <div class="campus-item">
        <div class="name">Columbia</div>
        <div class="beds">745</div>
        <div class="type">Academic Medical Center</div>
      </div>
      <div class="campus-item">
        <div class="name">Allen Hospital</div>
        <div class="beds">196</div>
        <div class="type">Community Hospital</div>
      </div>
      <div class="campus-item">
        <div class="name">Lower Manhattan</div>
        <div class="beds">180</div>
        <div class="type">Community Hospital</div>
      </div>
      <div class="campus-item">
        <div class="name">Queens</div>
        <div class="beds">535</div>
        <div class="type">Community Hospital</div>
      </div>
      <div class="campus-item">
        <div class="name">Brooklyn Methodist</div>
        <div class="beds">591</div>
        <div class="type">Community Hospital</div>
      </div>
      <div class="campus-item">
        <div class="name">Westchester</div>
        <div class="beds">288</div>
        <div class="type">Behavioral Health</div>
      </div>
      <div class="campus-item">
        <div class="name">Hudson Valley</div>
        <div class="beds">164</div>
        <div class="type">Community Hospital</div>
      </div>
    </div>
  </div>

  <!-- Interactive Campus Map -->
  <div class="card" style="grid-column:1/-1">
    <div class="card-header">
      <span class="card-title">Campus Locations ‚Äî NYC Metro Area</span>
      <span class="card-icon">üó∫Ô∏è</span>
    </div>
    <div id="campus-map" style="height:450px;border-radius:8px;overflow:hidden;border:1px solid var(--card-border)"></div>
    <div style="display:flex;gap:0.5rem;margin-top:0.75rem;flex-wrap:wrap;justify-content:center">
      <span class="tag highlight" style="cursor:pointer" onclick="mapFlyTo(40.7648,-73.9538,14)">Weill Cornell</span>
      <span class="tag highlight" style="cursor:pointer" onclick="mapFlyTo(40.8405,-73.9422,14)">Columbia</span>
      <span class="tag" style="cursor:pointer" onclick="mapFlyTo(40.8782,-73.9265,14)">Allen</span>
      <span class="tag" style="cursor:pointer" onclick="mapFlyTo(40.7107,-74.0026,14)">Lower Manhattan</span>
      <span class="tag" style="cursor:pointer" onclick="mapFlyTo(40.7470,-73.8833,14)">Queens</span>
      <span class="tag" style="cursor:pointer" onclick="mapFlyTo(40.6710,-73.9786,14)">Brooklyn Methodist</span>
      <span class="tag" style="cursor:pointer" onclick="mapFlyTo(41.0526,-73.7584,14)">Westchester</span>
      <span class="tag" style="cursor:pointer" onclick="mapFlyTo(41.2905,-73.8933,14)">Hudson Valley</span>
      <span class="tag" style="cursor:pointer;background:var(--accent);color:#000;border-color:var(--accent)" onclick="mapFitAll()">View All</span>
    </div>
  </div>

  <!-- US News Rankings -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">US News Best Hospitals ‚Äî Specialty Rankings</span>
      <span class="card-icon">üèÜ</span>
    </div>
    <table class="ranking-table">
      <tr><th>Specialty</th><th>Rank</th><th>Score</th></tr>
      <tr><td>Psychiatry</td><td class="rank">#1</td><td>100.0</td></tr>
      <tr><td>Cardiology & Heart Surgery</td><td class="rank">#3</td><td>96.2</td></tr>
      <tr><td>Neurology & Neurosurgery</td><td class="rank">#4</td><td>94.8</td></tr>
      <tr><td>Diabetes & Endocrinology</td><td class="rank">#4</td><td>93.1</td></tr>
      <tr><td>Gastroenterology & GI Surgery</td><td class="rank">#5</td><td>91.7</td></tr>
      <tr><td>Geriatrics</td><td class="rank">#5</td><td>89.4</td></tr>
      <tr><td>Orthopedics</td><td class="rank">#6</td><td>88.6</td></tr>
      <tr><td>Urology</td><td class="rank">#6</td><td>87.3</td></tr>
      <tr><td>Cancer (Oncology)</td><td class="rank">#7</td><td>86.9</td></tr>
      <tr><td>Pulmonology & Lung Surgery</td><td class="rank">#8</td><td>84.2</td></tr>
    </table>
  </div>

  <!-- Quality Metrics -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Quality & Safety Metrics</span>
      <span class="card-icon">üõ°Ô∏è</span>
    </div>
    <div class="stat-row">
      <span class="label">CMS Star Rating</span>
      <span class="value"><span class="stars"><span class="star filled">‚òÖ</span><span class="star filled">‚òÖ</span><span class="star filled">‚òÖ</span><span class="star filled">‚òÖ</span><span class="star empty">‚òÖ</span></span></span>
    </div>
    <div class="stat-row">
      <span class="label">Leapfrog Safety Grade</span>
      <span class="value" style="color:var(--success)">A</span>
    </div>
    <div class="stat-row">
      <span class="label">Magnet Recognition (Nursing)</span>
      <span class="value" style="color:var(--accent)">‚úì Active</span>
    </div>
    <div class="stat-row">
      <span class="label">30-Day Readmission Rate</span>
      <span class="value">14.8% <span style="color:var(--success);font-size:0.7rem">‚ñº better than national</span></span>
    </div>
    <div class="stat-row">
      <span class="label">Patient Satisfaction (HCAHPS)</span>
      <span class="value">76% <span style="color:var(--success);font-size:0.7rem">‚ñ≤ above average</span></span>
    </div>
    <div class="stat-row">
      <span class="label">Mortality Index</span>
      <span class="value" style="color:var(--success)">Below Expected</span>
    </div>
    <div class="stat-row">
      <span class="label">HAI Performance</span>
      <span class="value" style="color:var(--success)">4/5 below national</span>
    </div>
  </div>

  <!-- Revenue Mix -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Revenue Composition</span>
      <span class="card-icon">üí∞</span>
    </div>
    <div class="donut-container">
      <div class="donut" style="background:conic-gradient(var(--accent) 0% 38%, var(--accent2) 38% 62%, var(--accent3) 62% 78%, #fbbf24 78% 89%, var(--text-dim) 89% 100%)">
        <div class="donut-center">
          <div class="value">$12.8B</div>
          <div class="label">Total</div>
        </div>
      </div>
      <div class="donut-legend">
        <div class="legend-item"><span class="legend-dot" style="background:var(--accent)"></span>Inpatient Services (38%)</div>
        <div class="legend-item"><span class="legend-dot" style="background:var(--accent2)"></span>Outpatient Services (24%)</div>
        <div class="legend-item"><span class="legend-dot" style="background:var(--accent3)"></span>Physician Services (16%)</div>
        <div class="legend-item"><span class="legend-dot" style="background:#fbbf24"></span>Research & Grants (11%)</div>
        <div class="legend-item"><span class="legend-dot" style="background:var(--text-dim)"></span>Other Revenue (11%)</div>
      </div>
    </div>
  </div>

  <!-- Financial Health -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Financial Health Indicators</span>
      <span class="card-icon">üìà</span>
    </div>
    <div class="stat-row">
      <span class="label">Operating Margin</span>
      <span class="value" style="color:var(--success)">3.4%</span>
    </div>
    <div class="stat-row">
      <span class="label">Total Margin</span>
      <span class="value" style="color:var(--success)">5.1%</span>
    </div>
    <div class="stat-row">
      <span class="label">Days Cash on Hand</span>
      <span class="value">198 days</span>
    </div>
    <div class="stat-row">
      <span class="label">Debt-to-Capitalization</span>
      <span class="value">38.2%</span>
    </div>
    <div class="stat-row">
      <span class="label">Bond Rating (Moody's)</span>
      <span class="value" style="color:var(--accent)">Aa3 Stable</span>
    </div>
    <div class="stat-row">
      <span class="label">Endowment</span>
      <span class="value">$4.2B</span>
    </div>
    <div class="stat-row">
      <span class="label">Capital Expenditure</span>
      <span class="value">$1.8B planned</span>
    </div>
  </div>

  <!-- Research & Innovation -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Research & Innovation</span>
      <span class="card-icon">üî¨</span>
    </div>
    <div class="kpi-grid" style="grid-template-columns:1fr 1fr">
      <div class="kpi">
        <div class="value" style="font-size:1.5rem;color:var(--accent2)">$890M</div>
        <div class="label">NIH Funding (combined)</div>
      </div>
      <div class="kpi">
        <div class="value" style="font-size:1.5rem;color:var(--accent3)">3,200+</div>
        <div class="label">Active Clinical Trials</div>
      </div>
    </div>
    <div style="margin-top:1rem">
      <div class="bar-chart">
        <div class="bar-item">
          <span class="bar-label">Weill Cornell</span>
          <div class="bar-track"><div class="bar-fill blue" style="width:92%">$547M</div></div>
        </div>
        <div class="bar-item">
          <span class="bar-label">Columbia</span>
          <div class="bar-track"><div class="bar-fill purple" style="width:78%">$343M</div></div>
        </div>
      </div>
    </div>
    <div class="tag-cloud" style="margin-top:1rem">
      <span class="tag highlight">AI Diagnostics</span>
      <span class="tag highlight">Precision Medicine</span>
      <span class="tag">Genomics</span>
      <span class="tag">Digital Health</span>
      <span class="tag">Telehealth</span>
      <span class="tag">Robotic Surgery</span>
      <span class="tag">Cell Therapy</span>
      <span class="tag">Neuroscience</span>
    </div>
  </div>

  <!-- Digital & Telehealth -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Digital Transformation</span>
      <span class="card-icon">üíª</span>
    </div>
    <div class="stat-row">
      <span class="label">Epic EHR</span>
      <span class="value" style="color:var(--success)">System-wide</span>
    </div>
    <div class="stat-row">
      <span class="label">Telehealth Visits (2025)</span>
      <span class="value">1.2M+ <span style="color:var(--success);font-size:0.7rem">‚ñ≤ 15%</span></span>
    </div>
    <div class="stat-row">
      <span class="label">MyChart Active Users</span>
      <span class="value">1.8M</span>
    </div>
    <div class="stat-row">
      <span class="label">AI Tools in Production</span>
      <span class="value" style="color:var(--accent2)">24</span>
    </div>
    <div class="stat-row">
      <span class="label">HIMSS EMRAM Stage</span>
      <span class="value" style="color:var(--accent)">Stage 7</span>
    </div>
    <div class="stat-row">
      <span class="label">Cybersecurity Framework</span>
      <span class="value">NIST CSF 2.0</span>
    </div>
  </div>

  <!-- Key Capital Projects -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Major Capital Projects</span>
      <span class="card-icon">üèóÔ∏è</span>
    </div>
    <div class="bar-chart">
      <div class="bar-item">
        <span class="bar-label" style="width:160px">David H. Koch Center</span>
        <div class="bar-track"><div class="bar-fill green" style="width:100%">Complete ‚úì</div></div>
      </div>
      <div class="bar-item">
        <span class="bar-label" style="width:160px">Queens Expansion</span>
        <div class="bar-track"><div class="bar-fill blue" style="width:75%">75% ‚Äî 2027</div></div>
      </div>
      <div class="bar-item">
        <span class="bar-label" style="width:160px">Brooklyn Tower</span>
        <div class="bar-track"><div class="bar-fill purple" style="width:45%">45% ‚Äî 2028</div></div>
      </div>
      <div class="bar-item">
        <span class="bar-label" style="width:160px">Ambulatory Network</span>
        <div class="bar-track"><div class="bar-fill gold" style="width:60%">60% ‚Äî Ongoing</div></div>
      </div>
    </div>
  </div>

  <!-- Peer Comparison -->
  <div class="card" style="grid-column:1/-1">
    <div class="card-header">
      <span class="card-title">Peer Comparison ‚Äî NYC Academic Medical Centers</span>
      <span class="card-icon">‚öñÔ∏è</span>
    </div>
    <table class="ranking-table">
      <tr><th>System</th><th>US News Rank (NY)</th><th>Beds</th><th>Revenue</th><th>CMS Stars</th><th>Specialties Ranked</th></tr>
      <tr style="background:#1a1a2e;border-radius:8px"><td><strong style="color:var(--accent)">NYP</strong></td><td class="rank">#1</td><td>2,600+</td><td>$12.8B</td><td>‚òÖ‚òÖ‚òÖ‚òÖ</td><td>15</td></tr>
      <tr><td>Mount Sinai</td><td>#2</td><td>1,139</td><td>$8.7B</td><td>‚òÖ‚òÖ‚òÖ‚òÖ</td><td>13</td></tr>
      <tr><td>NYU Langone</td><td>#3</td><td>1,076</td><td>$10.2B</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>14</td></tr>
      <tr><td>Northwell Health</td><td>#5</td><td>3,800+</td><td>$16.1B</td><td>‚òÖ‚òÖ‚òÖ</td><td>8</td></tr>
      <tr><td>Montefiore</td><td>#8</td><td>1,491</td><td>$6.8B</td><td>‚òÖ‚òÖ‚òÖ</td><td>6</td></tr>
    </table>
  </div>

</div>

<div class="footer">
  NYP Dashboard ¬∑ Data sourced from public filings, CMS Hospital Compare, US News & World Report, NIH Reporter ¬∑ Built for Project PS<br>
  <span id="cms-status">Connecting to CMS Hospital Compare API‚Ä¶</span>
</div>

<script>
// Campus Map
var campusMap, campusMarkers=[];
(function initMap(){
  var campuses=[
    {name:'Weill Cornell Medical Center',type:'Academic Medical Center',cls:'academic',lat:40.7648,lng:-73.9538,beds:862,specialties:'Cardiology, Oncology, Neurology',cms:'330101',icon:'üèõÔ∏è'},
    {name:'Columbia University Irving Medical Center',type:'Academic Medical Center',cls:'academic',lat:40.8405,lng:-73.9422,beds:745,specialties:'Neurosurgery, Psychiatry, Transplant',cms:'330024',icon:'üèõÔ∏è'},
    {name:'Allen Hospital',type:'Community Hospital',cls:'',lat:40.8782,lng:-73.9265,beds:196,specialties:'Emergency, General Surgery',cms:'330193',icon:'üè•'},
    {name:'Lower Manhattan Hospital',type:'Community Hospital',cls:'',lat:40.7107,lng:-74.0026,beds:180,specialties:'Emergency, Orthopedics',cms:'330214',icon:'üè•'},
    {name:'Queens',type:'Community Hospital',cls:'',lat:40.7470,lng:-73.8833,beds:535,specialties:'Cardiac, Stroke, Maternity',cms:'330055',icon:'üè•'},
    {name:'Brooklyn Methodist Hospital',type:'Community Hospital',cls:'',lat:40.6710,lng:-73.9786,beds:591,specialties:'Robotic Surgery, Cancer',cms:'330005',icon:'üè•'},
    {name:'Westchester Behavioral Health',type:'Behavioral Health Center',cls:'behavioral',lat:41.0526,lng:-73.7584,beds:288,specialties:'Psychiatry, Addiction, Pediatric MH',cms:'332059',icon:'üß†'},
    {name:'Hudson Valley Hospital',type:'Community Hospital',cls:'',lat:41.2905,lng:-73.8933,beds:164,specialties:'Emergency, Maternity, Oncology',cms:'330084',icon:'üè•'}
  ];
  campusMap=L.map('campus-map',{zoomControl:true,attributionControl:true,scrollWheelZoom:true}).setView([40.82,-73.92],10);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{
    attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OSM</a> ¬© <a href="https://carto.com/">CARTO</a>',
    subdomains:'abcd',maxZoom:19
  }).addTo(campusMap);
  campuses.forEach(function(c){
    var icon=L.divIcon({className:'',html:'<div class="campus-marker '+c.cls+'">'+c.icon+'</div>',iconSize:[36,36],iconAnchor:[18,18],popupAnchor:[0,-20]});
    var popup='<div class="popup-name">'+c.name+'</div><div class="popup-type">'+c.type+'</div>'
      +'<div class="popup-stat"><span class="label">Licensed Beds</span><span class="val">'+c.beds+'</span></div>'
      +'<div class="popup-stat"><span class="label">Key Specialties</span><span class="val" style="text-align:right;max-width:150px">'+c.specialties+'</span></div>'
      +'<div class="popup-stat"><span class="label">CMS ID</span><span class="val" style="color:var(--text-dim)">'+c.cms+'</span></div>';
    var m=L.marker([c.lat,c.lng],{icon:icon}).addTo(campusMap).bindPopup(popup,{maxWidth:280});
    campusMarkers.push(m);
  });
})();
function mapFlyTo(lat,lng,z){campusMap.flyTo([lat,lng],z,{duration:1})}
function mapFitAll(){var g=L.featureGroup(campusMarkers);campusMap.flyToBounds(g.getBounds().pad(0.1),{duration:1})}
</script>

<script>
(function(){
  // CMS Provider IDs for NYP campuses
  const PROVIDERS = {
    weillCornell: '330101',
    columbia: '330024',
    queens: '330055',
    brooklyn: '330005',
    allen: '330193',
    lowerManhattan: '330214',
    hudson: '330084',
    westchester: '332059'
  };
  const PRIMARY = PROVIDERS.weillCornell;
  const PRIMARY_IDS = [PROVIDERS.weillCornell, PROVIDERS.columbia];

  const CMS_BASE = 'https://data.cms.gov/provider-data/api/1/datastore/query';

  // Dataset IDs (CMS Provider Data Catalog)
  const DATASETS = {
    general: 'xubh-q36u',       // Hospital General Information
    hcahps: 'dgck-syfz',        // Patient Survey (HCAHPS)
    readmissions: '632h-zaca',   // Unplanned Hospital Visits
    complications: 'ynj2-r877',  // Complications and Deaths
    timely: 'yv7e-xc69',        // Timely and Effective Care
    infections: '77hc-ibv8'      // Healthcare Associated Infections
  };

  function cmsQuery(dataset, conditions, limit) {
    const params = new URLSearchParams();
    params.set('limit', limit || 50);
    params.set('offset', 0);
    conditions.forEach(function(c) {
      params.append('conditions[0][property]', c.property);
      params.append('conditions[0][value]', c.value);
      params.append('conditions[0][operator]', c.operator || '=');
    });
    return fetch(CMS_BASE + '/' + dataset + '/0?' + params.toString())
      .then(function(r){ return r.json(); })
      .then(function(d){ return d.results || []; });
  }

  function queryProvider(dataset, providerId, limit) {
    return cmsQuery(dataset, [{property:'facility_id', value:providerId}], limit);
  }

  // Helper to update element text safely
  function setText(el, text) { if(el) el.textContent = text; }
  function setHTML(el, html) { if(el) el.innerHTML = html; }

  // Add data-cms-id attributes for targeted updates
  var qualityCard = null;
  var statRows = document.querySelectorAll('.stat-row');
  statRows.forEach(function(row){
    var label = row.querySelector('.label');
    if(!label) return;
    var t = label.textContent.trim().toLowerCase();
    if(t.includes('cms star')) row.setAttribute('data-cms','star-rating');
    if(t.includes('leapfrog')) row.setAttribute('data-cms','leapfrog');
    if(t.includes('readmission')) row.setAttribute('data-cms','readmission');
    if(t.includes('patient satisfaction') || t.includes('hcahps')) row.setAttribute('data-cms','hcahps');
    if(t.includes('mortality')) row.setAttribute('data-cms','mortality');
    if(t.includes('hai performance')) row.setAttribute('data-cms','hai');
  });

  var results = { loaded: 0, total: 3 };

  function checkDone(){
    results.loaded++;
    var statusEl = document.getElementById('cms-status');
    if(results.loaded >= results.total){
      setText(statusEl, '‚úÖ Live CMS data loaded ¬∑ Last API fetch: ' + new Date().toLocaleString());
      // Update header badge
      var badge = document.querySelector('.header .badge');
      if(badge){
        badge.textContent = 'LIVE DATA';
        badge.style.background = 'var(--success)';
      }
      // Update last-updated
      var lu = document.querySelector('.last-updated');
      if(lu) setText(lu, 'Live from CMS Hospital Compare ¬∑ ' + new Date().toLocaleDateString());
    } else {
      setText(statusEl, 'Loading CMS data‚Ä¶ (' + results.loaded + '/' + results.total + ')');
    }
  }

  // 1. General Information ‚Üí Star Rating
  queryProvider(DATASETS.general, PRIMARY, 5).then(function(rows){
    if(rows.length === 0) return;
    var row = rows[0];
    var starEl = document.querySelector('[data-cms="star-rating"] .value');
    if(starEl && row.hospital_overall_rating && row.hospital_overall_rating !== 'Not Available'){
      var n = parseInt(row.hospital_overall_rating);
      var stars = '';
      for(var i=1;i<=5;i++){
        stars += '<span class="star '+(i<=n?'filled':'empty')+'">‚òÖ</span>';
      }
      setHTML(starEl, '<span class="stars">' + stars + '</span>');
    }
    // Also check for emergency services, hospital type
  }).catch(function(){}).finally(checkDone);

  // 2. HCAHPS Patient Satisfaction
  queryProvider(DATASETS.hcahps, PRIMARY, 100).then(function(rows){
    if(rows.length === 0) return;
    // Find overall hospital rating (H_STAR_RATING or H_HSP_RATING_*)
    var overallRow = rows.find(function(r){
      return r.hcahps_measure_id === 'H_HSP_RATING_9_10' || r.hcahps_measure_id === 'H_STAR_RATING';
    });
    var hcahpsEl = document.querySelector('[data-cms="hcahps"] .value');
    if(overallRow && hcahpsEl){
      var pct = overallRow.hcahps_answer_percent || overallRow.patient_survey_star_rating;
      if(pct && pct !== 'Not Applicable' && pct !== 'Not Available'){
        var val = pct.replace('%','');
        var natl = overallRow.hcahps_answer_percent_footnote || '';
        var comparison = '';
        if(overallRow.hcahps_linear_mean_value){
          comparison = ' <span style="color:var(--success);font-size:0.7rem">CMS Live</span>';
        } else {
          comparison = ' <span style="color:var(--accent);font-size:0.7rem">CMS Live</span>';
        }
        setHTML(hcahpsEl, val + '%' + comparison);
      }
    }
    // Find recommend hospital rate
    var recRow = rows.find(function(r){
      return r.hcahps_measure_id === 'H_RECMND_DY';
    });
  }).catch(function(){}).finally(checkDone);

  // 3. Readmissions & Mortality
  queryProvider(DATASETS.readmissions, PRIMARY, 100).then(function(rows){
    if(rows.length === 0) return;
    // Find hospital-wide readmission
    var readmitRow = rows.find(function(r){
      return r.measure_id === 'READM_30_HOSP_WIDE' || (r.measure_name && r.measure_name.toLowerCase().includes('hospital-wide'));
    });
    var readmitEl = document.querySelector('[data-cms="readmission"] .value');
    if(readmitRow && readmitEl){
      var score = readmitRow.score;
      if(score && score !== 'Not Available'){
        var pct = parseFloat(score);
        var arrow = pct < 15.5 ? '‚ñº better than national' : (pct > 15.5 ? '‚ñ≤ above national' : '‚Äî national avg');
        var color = pct < 15.5 ? 'var(--success)' : (pct > 15.5 ? 'var(--danger)' : 'var(--warning)');
        setHTML(readmitEl, pct.toFixed(1) + '% <span style="color:'+color+';font-size:0.7rem">'+arrow+' ¬∑ CMS Live</span>');
      }
    }

    // Mortality
    var mortRow = rows.find(function(r){
      return r.measure_id === 'MORT_30_HOSP_WIDE' || (r.measure_name && r.measure_name.toLowerCase().includes('death'));
    });
    // Update mortality via compared_to_national
  }).catch(function(){}).finally(checkDone);

  // 4. HAI / Infections (bonus, non-blocking)
  queryProvider(DATASETS.infections, PRIMARY, 100).then(function(rows){
    if(rows.length === 0) return;
    var haiEl = document.querySelector('[data-cms="hai"] .value');
    if(!haiEl) return;
    var measures = ['HAI_1','HAI_2','HAI_3','HAI_4','HAI_5','HAI_6'];
    var below = 0, total = 0;
    rows.forEach(function(r){
      if(measures.some(function(m){ return r.measure_id && r.measure_id.startsWith(m); })){
        if(r.compared_to_national){
          total++;
          var c = r.compared_to_national.toLowerCase();
          if(c.includes('better') || c.includes('below')) below++;
        }
      }
    });
    if(total > 0){
      setHTML(haiEl, below + '/' + total + ' below national <span style="color:var(--accent);font-size:0.7rem">CMS Live</span>');
    }
  }).catch(function(){});

})();
</script>

</body>
</html>
